server {
    listen 80;
    server_name 103.158.36.26; # 如果有域名，请替换为域名（例如: example.com）

    # 开启 Gzip 压缩提升性能
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    location / {
        proxy_pass http://127.0.0.1:3000; # 转发到 Next.js 默认端口
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;

        # 增加超时时间防止长连接断开
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
    
    # 将原来的本地大文件存档请求，在服务器层面转发/重定向到 OSS
    # 这样你的代码完全不用改配置，依然写 /archive/...
    location /archive/ {
        # 使用 302 重定向到阿里云 OSS
        rewrite ^/archive/(.*)$ https://jlu-biomod-assets.oss-cn-guangzhou.aliyuncs.com/archive/$1 redirect;
    }

    # 可选：如果后续使用静态资源加速
    # location /_next/static {
    #     alias /var/www/jlu-biomod/.next/static;
    #     expires 365d;
    #     access_log off;
    # }
}
